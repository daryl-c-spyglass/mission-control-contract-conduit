Simplified Layout Tab - Subject Property Cover Photo Only
Task
Rebuild the Layout tab to focus ONLY on selecting the cover photo for the subject property. Remove all comparable properties layout options.

What the Layout Tab Should Do
Single Purpose: Select the best photo for the CMA presentation cover page

Part 1: Simplified State
tsx// CMAPresentationBuilder.tsx - Replace layoutSettings state

const [coverPhotoSettings, setCoverPhotoSettings] = useState({
  photoUrl: null as string | null,
  source: 'ai' as 'ai' | 'manual', // AI auto-selects best exterior/front
});

// Photo modal state for zoom preview
const [photoModal, setPhotoModal] = useState<{
  isOpen: boolean;
  photoUrl: string | null;
  photoLabel: string | null;
}>({
  isOpen: false,
  photoUrl: null,
  photoLabel: null,
});

Part 2: Simplified Layout Tab JSX
tsx{/* Layout Tab Content */}
{activeTab === 'layout' && (
  <div className="space-y-6">
    
    {/* Cover Page Photo Selection */}
    <div className="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
      <div className="flex items-center gap-2 mb-1">
        <ImageIcon className="w-5 h-5 text-primary" />
        <h2 className="text-lg font-semibold text-gray-900 dark:text-white">
          Cover Page Photo
        </h2>
      </div>
      <p className="text-sm text-gray-500 dark:text-gray-400 mb-4">
        Select the main photo for your CMA presentation cover
      </p>

      {/* AI / Manual Toggle */}
      <div className="flex items-center gap-3 mb-5">
        <button
          onClick={() => setCoverPhotoSettings(prev => ({ ...prev, source: 'ai' }))}
          className={cn(
            "flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-all text-sm font-medium",
            coverPhotoSettings.source === 'ai'
              ? "border-primary bg-primary/10 text-primary"
              : "border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 hover:border-gray-300"
          )}
        >
          <Sparkles className="w-4 h-4" />
          AI Best Photo
        </button>
        <button
          onClick={() => setCoverPhotoSettings(prev => ({ ...prev, source: 'manual' }))}
          className={cn(
            "flex items-center gap-2 px-4 py-2 rounded-lg border-2 transition-all text-sm font-medium",
            coverPhotoSettings.source === 'manual'
              ? "border-primary bg-primary/10 text-primary"
              : "border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 hover:border-gray-300"
          )}
        >
          <MousePointer className="w-4 h-4" />
          Manual Selection
        </button>
      </div>

      {/* Subject Property Info */}
      <div className="mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
        <h3 className="font-medium text-gray-900 dark:text-white">
          {subjectProperty?.unparsedAddress?.split(',')[0] || subjectProperty?.address || 'Subject Property'}
        </h3>
        <p className="text-sm text-gray-500">
          {(subjectProperty?.photos || []).length} photos available
        </p>
      </div>

      {/* Photo Grid */}
      <CoverPhotoGrid
        photos={subjectProperty?.photos || []}
        selectedPhoto={coverPhotoSettings.photoUrl}
        source={coverPhotoSettings.source}
        imageInsights={subjectProperty?.imageInsights?.images}
        onSelect={(url) => setCoverPhotoSettings(prev => ({ ...prev, photoUrl: url }))}
        onPreview={(url, label) => setPhotoModal({ isOpen: true, photoUrl: url, photoLabel: label })}
      />
    </div>

    {/* Photo Preview Modal */}
    <PhotoPreviewModal
      isOpen={photoModal.isOpen}
      photoUrl={photoModal.photoUrl}
      photoLabel={photoModal.photoLabel}
      onClose={() => setPhotoModal({ isOpen: false, photoUrl: null, photoLabel: null })}
    />
  </div>
)}

Part 3: Cover Photo Grid Component
tsx// client/src/components/cma/CoverPhotoGrid.tsx

import React, { useMemo, useEffect } from 'react';
import { Check, Sparkles, ZoomIn } from 'lucide-react';
import { cn } from '@/lib/utils';
import { Badge } from '@/components/ui/badge';

interface CoverPhotoGridProps {
  photos: string[];
  selectedPhoto: string | null;
  source: 'ai' | 'manual';
  imageInsights?: any[];
  onSelect: (url: string) => void;
  onPreview: (url: string, label: string | null) => void;
}

export function CoverPhotoGrid({
  photos,
  selectedPhoto,
  source,
  imageInsights,
  onSelect,
  onPreview,
}: CoverPhotoGridProps) {
  
  // AI recommendation - find best exterior/front photo
  const aiRecommendation = useMemo(() => {
    if (!photos.length) return null;
    
    // If we have Image Insights, use them
    if (imageInsights?.length) {
      const priorities = ['front', 'exterior', 'facade'];
      
      for (const priority of priorities) {
        const match = imageInsights.find((img: any) => 
          img.classification?.imageOf?.toLowerCase().includes(priority)
        );
        if (match) {
          const index = match.originalIndex ?? imageInsights.indexOf(match);
          return { 
            url: photos[index], 
            label: match.classification?.imageOf,
            quality: match.quality?.qualitative,
            index 
          };
        }
      }
      
      // Fallback: highest quality
      const sorted = [...imageInsights].sort((a, b) => 
        (b.quality?.score || 0) - (a.quality?.score || 0)
      );
      if (sorted[0]) {
        const index = sorted[0].originalIndex ?? 0;
        return {
          url: photos[index],
          label: sorted[0].classification?.imageOf || 'Best Quality',
          quality: sorted[0].quality?.qualitative,
          index
        };
      }
    }
    
    // No insights - default to first photo
    return { url: photos[0], label: 'Primary Photo', quality: null, index: 0 };
  }, [imageInsights, photos]);

  // Auto-select AI recommendation
  useEffect(() => {
    if (source === 'ai' && aiRecommendation && !selectedPhoto) {
      onSelect(aiRecommendation.url);
    }
  }, [source, aiRecommendation]);

  // When switching to AI mode, select AI recommendation
  useEffect(() => {
    if (source === 'ai' && aiRecommendation) {
      onSelect(aiRecommendation.url);
    }
  }, [source]);

  const getPhotoInfo = (index: number) => {
    if (!imageInsights?.[index]) return null;
    return {
      label: imageInsights[index].classification?.imageOf,
      quality: imageInsights[index].quality?.qualitative,
    };
  };

  if (!photos.length) {
    return (
      <div className="text-center py-8 text-gray-500">
        No photos available for this property
      </div>
    );
  }

  return (
    <div className="space-y-4">
      {/* AI Recommendation Banner */}
      {source === 'ai' && aiRecommendation && (
        <div className="flex items-center gap-2 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800">
          <Sparkles className="w-4 h-4 text-amber-600 flex-shrink-0" />
          <span className="text-sm text-amber-800 dark:text-amber-200">
            AI selected: <strong>{aiRecommendation.label || 'Best photo'}</strong>
            {aiRecommendation.quality && (
              <Badge variant="secondary" className="ml-2 text-xs bg-amber-100 dark:bg-amber-800">
                {aiRecommendation.quality}
              </Badge>
            )}
          </span>
        </div>
      )}

      {/* Photo Grid */}
      <div className="grid grid-cols-4 sm:grid-cols-6 gap-3">
        {photos.slice(0, 12).map((photo, idx) => {
          const isSelected = selectedPhoto === photo;
          const isAiPick = source === 'ai' && aiRecommendation?.index === idx;
          const info = getPhotoInfo(idx);
          
          return (
            <div key={idx} className="relative group">
              <button
                onClick={() => source === 'manual' && onSelect(photo)}
                className={cn(
                  "relative aspect-square rounded-lg overflow-hidden border-2 transition-all w-full",
                  isSelected 
                    ? "border-primary ring-2 ring-primary/30" 
                    : "border-gray-200 dark:border-gray-700",
                  source === 'manual' && "hover:border-primary/50 cursor-pointer",
                  source === 'ai' && !isSelected && "opacity-50 cursor-default"
                )}
              >
                <img 
                  src={photo} 
                  alt={info?.label || `Photo ${idx + 1}`}
                  className="w-full h-full object-cover"
                  loading="lazy"
                />
                
                {/* Selected checkmark */}
                {isSelected && (
                  <div className="absolute top-1.5 right-1.5 w-6 h-6 bg-primary rounded-full flex items-center justify-center shadow-lg">
                    <Check className="w-4 h-4 text-white" />
                  </div>
                )}
                
                {/* AI Pick badge */}
                {isAiPick && (
                  <div className="absolute top-1.5 left-1.5">
                    <Badge className="bg-amber-500 text-white text-[10px] px-1.5 py-0.5 shadow">
                      <Sparkles className="w-3 h-3" />
                    </Badge>
                  </div>
                )}
                
                {/* Classification label */}
                {info?.label && (
                  <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-1.5">
                    <span className="text-[11px] text-white font-medium truncate block">
                      {info.label}
                    </span>
                  </div>
                )}

                {/* Quality indicator */}
                {info?.quality && !isAiPick && (
                  <div className={cn(
                    "absolute top-1.5 left-1.5 w-2.5 h-2.5 rounded-full border border-white shadow",
                    info.quality === 'excellent' && "bg-green-500",
                    info.quality === 'above average' && "bg-blue-500",
                    info.quality === 'average' && "bg-yellow-500",
                  )} />
                )}
              </button>
              
              {/* Zoom button on hover */}
              <button
                onClick={(e) => {
                  e.stopPropagation();
                  onPreview(photo, info?.label || `Photo ${idx + 1}`);
                }}
                className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-9 h-9 bg-black/60 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-black/80"
                title="Click to preview"
              >
                <ZoomIn className="w-4 h-4 text-white" />
              </button>
            </div>
          );
        })}
      </div>

      {/* Show more indicator */}
      {photos.length > 12 && (
        <p className="text-xs text-gray-500 text-center">
          Showing 12 of {photos.length} photos
        </p>
      )}

      {/* Quality Legend */}
      {imageInsights?.length > 0 && (
        <div className="flex items-center justify-center gap-4 text-xs text-gray-500 pt-2 border-t border-gray-100 dark:border-gray-800">
          <span className="font-medium">Quality:</span>
          <span className="flex items-center gap-1">
            <span className="w-2.5 h-2.5 rounded-full bg-green-500" /> Excellent
          </span>
          <span className="flex items-center gap-1">
            <span className="w-2.5 h-2.5 rounded-full bg-blue-500" /> Above Average
          </span>
          <span className="flex items-center gap-1">
            <span className="w-2.5 h-2.5 rounded-full bg-yellow-500" /> Average
          </span>
        </div>
      )}
    </div>
  );
}

Part 4: Photo Preview Modal (Zoom)
tsx// client/src/components/cma/PhotoPreviewModal.tsx

import React, { useState, useEffect } from 'react';
import { X, ZoomIn, ZoomOut, RotateCw, Download, Maximize2 } from 'lucide-react';
import { Dialog, DialogContent } from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';

interface PhotoPreviewModalProps {
  isOpen: boolean;
  photoUrl: string | null;
  photoLabel: string | null;
  onClose: () => void;
}

export function PhotoPreviewModal({
  isOpen,
  photoUrl,
  photoLabel,
  onClose,
}: PhotoPreviewModalProps) {
  const [zoom, setZoom] = useState(1);
  const [rotation, setRotation] = useState(0);

  // Reset on open
  useEffect(() => {
    if (isOpen) {
      setZoom(1);
      setRotation(0);
    }
  }, [isOpen]);

  const handleDownload = () => {
    if (!photoUrl) return;
    const link = document.createElement('a');
    link.href = photoUrl;
    link.download = `${photoLabel || 'cover-photo'}.jpg`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  };

  if (!photoUrl) return null;

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-5xl w-[95vw] h-[85vh] p-0 overflow-hidden bg-gray-950 border-gray-800">
        {/* Header */}
        <div className="absolute top-0 left-0 right-0 z-10 flex items-center justify-between px-4 py-3 bg-gradient-to-b from-black/90 to-transparent">
          <div className="text-white">
            <h3 className="font-medium text-lg">{photoLabel || 'Photo Preview'}</h3>
            <p className="text-sm text-gray-400">Zoom: {Math.round(zoom * 100)}%</p>
          </div>
          <Button
            variant="ghost"
            size="icon"
            onClick={onClose}
            className="text-white hover:bg-white/20 rounded-full"
          >
            <X className="w-5 h-5" />
          </Button>
        </div>

        {/* Image */}
        <div className="flex-1 flex items-center justify-center overflow-auto p-4 pt-20 pb-24">
          <img
            src={photoUrl}
            alt={photoLabel || 'Preview'}
            className="max-w-full max-h-full object-contain transition-transform duration-200 select-none"
            style={{
              transform: `scale(${zoom}) rotate(${rotation}deg)`,
            }}
            draggable={false}
          />
        </div>

        {/* Controls */}
        <div className="absolute bottom-0 left-0 right-0 z-10 flex items-center justify-center gap-2 px-4 py-4 bg-gradient-to-t from-black/90 to-transparent">
          <Button
            variant="secondary"
            size="sm"
            onClick={() => setZoom(prev => Math.max(prev - 0.25, 0.5))}
            disabled={zoom <= 0.5}
            className="bg-white/10 hover:bg-white/20 text-white border-0"
          >
            <ZoomOut className="w-4 h-4 mr-1.5" />
            Zoom Out
          </Button>
          
          <Button
            variant="secondary"
            size="sm"
            onClick={() => setZoom(prev => Math.min(prev + 0.25, 3))}
            disabled={zoom >= 3}
            className="bg-white/10 hover:bg-white/20 text-white border-0"
          >
            <ZoomIn className="w-4 h-4 mr-1.5" />
            Zoom In
          </Button>
          
          <Button
            variant="secondary"
            size="sm"
            onClick={() => setRotation(prev => (prev + 90) % 360)}
            className="bg-white/10 hover:bg-white/20 text-white border-0"
          >
            <RotateCw className="w-4 h-4 mr-1.5" />
            Rotate
          </Button>
          
          <div className="w-px h-6 bg-white/20 mx-1" />
          
          <Button
            variant="secondary"
            size="sm"
            onClick={() => { setZoom(1); setRotation(0); }}
            className="bg-white/10 hover:bg-white/20 text-white border-0"
          >
            <Maximize2 className="w-4 h-4 mr-1.5" />
            Reset
          </Button>
          
          <Button
            variant="secondary"
            size="sm"
            onClick={handleDownload}
            className="bg-white/10 hover:bg-white/20 text-white border-0"
          >
            <Download className="w-4 h-4 mr-1.5" />
            Download
          </Button>
        </div>
      </DialogContent>
    </Dialog>
  );
}

Part 5: Required Imports
tsx// Add to CMAPresentationBuilder.tsx
import { ImageIcon, Sparkles, MousePointer } from 'lucide-react';
import { CoverPhotoGrid } from '@/components/cma/CoverPhotoGrid';
import { PhotoPreviewModal } from '@/components/cma/PhotoPreviewModal';

Files to Create/Modify

client/src/pages/CMAPresentationBuilder.tsx - Simplified Layout tab
client/src/components/cma/CoverPhotoGrid.tsx - New component
client/src/components/cma/PhotoPreviewModal.tsx - New component


Delete These (No Longer Needed)

Remove PhotoSelectionPreview.tsx (if exists)
Remove LayoutPreview.tsx (if exists)
Remove all comparable layout settings


Summary
FeaturePurposeAI Best PhotoAuto-selects best exterior/front photo using Repliers Image InsightsManual SelectionAgent can pick any photo they preferPhoto GridShows first 12 photos with quality indicators and room labelsZoom PreviewClick any photo to open full-size modal with zoom/rotate controlsQuality LegendGreen/Blue/Yellow dots show photo quality ratings

Acceptance Criteria

 Layout tab only shows "Cover Page Photo" section
 AI/Manual toggle buttons work correctly
 AI mode auto-selects best exterior photo and dims other options
 Manual mode allows clicking any photo to select it
 Hover on photo shows zoom icon
 Click zoom opens modal with full-size preview
 Modal has zoom in/out, rotate, reset, download controls
 Quality dots and room labels appear from Image Insights
 No comparable properties layout options anywhere