# Replit Agent Task: CMA Presentation UI Improvements

## Overview

Make the following changes to the CMA Presentation:
1. **Remove the star/favorites icon** from the upper right header
2. **Adjust the search icon** positioning after removal
3. **Convert CMA Presentation from modal to full page** view

---

## Part 1: Remove Favorites (Star) Icon

### Find and Remove

The star icon is likely in the CMA Presentation header. Search for it:

```bash
grep -rn "Star\|favorite\|Favorite" --include="*.tsx" client/src/
```

### In the header component, remove the star button:

```tsx
// BEFORE - Header with star icon
<div className="flex items-center gap-2">
  <button className="p-2 hover:bg-gray-100 rounded">
    <Search className="w-5 h-5" />
  </button>
  <button className="p-2 hover:bg-gray-100 rounded">
    <Star className="w-5 h-5" />  {/* ‚Üê REMOVE THIS */}
  </button>
  {/* ... other icons */}
</div>

// AFTER - Header without star icon
<div className="flex items-center gap-2">
  <button className="p-2 hover:bg-gray-100 rounded">
    <Search className="w-5 h-5" />
  </button>
  {/* Star removed, other icons remain */}
</div>
```

### Also remove any favorites-related imports:

```tsx
// Remove if no longer used
import { Star } from 'lucide-react';
```

---

## Part 2: Adjust Search Icon Positioning

After removing the star, ensure search icon is properly positioned:

```tsx
// Header right section
<div className="flex items-center gap-3">
  {/* Search button */}
  <button 
    onClick={() => setShowSearch(true)}
    className="p-2 text-gray-400 hover:text-gray-600 hover:bg-white/10 
               rounded-lg transition-colors"
    title="Search slides"
  >
    <Search className="w-5 h-5" />
  </button>
  
  {/* Download button (if exists) */}
  <button className="p-2 text-gray-400 hover:text-gray-600 hover:bg-white/10 
                     rounded-lg transition-colors">
    <Download className="w-5 h-5" />
  </button>
  
  {/* Close button */}
  <button 
    onClick={onClose}
    className="p-2 text-gray-400 hover:text-gray-600 hover:bg-white/10 
               rounded-lg transition-colors"
  >
    <X className="w-5 h-5" />
  </button>
</div>
```

---

## Part 3: Convert Modal to Full Page

### Current Modal Structure

```tsx
// Current: Modal overlay
<div className="fixed inset-0 z-50 bg-black/50">
  <div className="fixed inset-4 bg-white rounded-xl overflow-hidden">
    {/* Content */}
  </div>
</div>
```

### New Full Page Structure

Create a dedicated route/page for CMA Presentation:

### Step 1: Create the route

```tsx
// In App.tsx or router configuration
import { CMAPresentationPage } from './pages/CMAPresentationPage';

// Add route
<Route path="/cma/:cmaId/presentation" element={<CMAPresentationPage />} />

// Or if using wouter
<Route path="/cma/:cmaId/presentation">
  <CMAPresentationPage />
</Route>
```

### Step 2: Create the full page component

```tsx
// client/src/pages/CMAPresentationPage.tsx

import { useParams, useLocation } from 'wouter';
import { useQuery } from '@tanstack/react-query';
import { useState, useEffect } from 'react';
import { 
  ChevronLeft, ChevronRight, Search, Download, X, Menu,
  Home, ArrowLeft
} from 'lucide-react';

export function CMAPresentationPage() {
  const { cmaId } = useParams();
  const [, navigate] = useLocation();
  const [currentSlide, setCurrentSlide] = useState(0);
  const [showSections, setShowSections] = useState(false);
  
  // Fetch CMA data
  const { data: cma, isLoading } = useQuery({
    queryKey: ['cma-presentation', cmaId],
    queryFn: () => fetchCMAPresentation(cmaId),
  });
  
  // Handle keyboard navigation
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === 'ArrowRight' || e.key === ' ') {
        e.preventDefault();
        setCurrentSlide(prev => Math.min(prev + 1, slides.length - 1));
      } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        setCurrentSlide(prev => Math.max(prev - 1, 0));
      } else if (e.key === 'Escape') {
        handleExit();
      }
    };
    
    window.addEventListener('keydown', handleKeyDown);
    return () => window.removeEventListener('keydown', handleKeyDown);
  }, []);
  
  const handleExit = () => {
    // Navigate back to transaction or CMA list
    navigate(`/transactions/${cma?.transactionId}`);
  };
  
  if (isLoading) {
    return (
      <div className="h-screen w-screen flex items-center justify-center bg-gray-100">
        <div className="text-center">
          <div className="w-8 h-8 border-2 border-[#EF4923] border-t-transparent 
                          rounded-full animate-spin mx-auto mb-3" />
          <p className="text-gray-500">Loading presentation...</p>
        </div>
      </div>
    );
  }
  
  return (
    <div className="h-screen w-screen flex flex-col bg-gray-100 overflow-hidden">
      {/* Fixed Header */}
      <header className="flex-shrink-0 bg-gray-900 text-white">
        <div className="flex items-center justify-between px-4 h-14">
          {/* Left: Back button + Logo */}
          <div className="flex items-center gap-4">
            <button
              onClick={handleExit}
              className="flex items-center gap-2 text-gray-300 hover:text-white 
                         transition-colors"
            >
              <ArrowLeft className="w-5 h-5" />
              <span className="hidden sm:inline text-sm">Exit</span>
            </button>
            
            <div className="h-6 w-px bg-gray-700" />
            
            {/* Logo */}
            <img 
              src="/spyglass-logo-white.png" 
              alt="Spyglass Realty" 
              className="h-6"
            />
          </div>
          
          {/* Center: Title + Slide Counter */}
          <div className="absolute left-1/2 -translate-x-1/2 text-center">
            <h1 className="text-sm font-medium hidden md:block">
              {cma?.address || 'CMA Presentation'}
            </h1>
            <p className="text-xs text-gray-400">
              {currentSlide + 1} / {slides.length}
            </p>
          </div>
          
          {/* Right: Actions */}
          <div className="flex items-center gap-2">
            {/* Search */}
            <button 
              onClick={() => setShowSearch(true)}
              className="p-2 text-gray-400 hover:text-white hover:bg-white/10 
                         rounded-lg transition-colors"
              title="Search slides"
            >
              <Search className="w-5 h-5" />
            </button>
            
            {/* Sections Menu */}
            <button 
              onClick={() => setShowSections(true)}
              className="p-2 text-gray-400 hover:text-white hover:bg-white/10 
                         rounded-lg transition-colors"
              title="Sections"
            >
              <Menu className="w-5 h-5" />
            </button>
            
            {/* Agent Info */}
            <div className="hidden sm:flex items-center gap-2 ml-2 pl-2 border-l border-gray-700">
              <span className="text-sm text-gray-300">{cma?.agentName}</span>
              {cma?.agentPhoto && (
                <img 
                  src={cma.agentPhoto} 
                  alt="" 
                  className="w-8 h-8 rounded-full object-cover"
                />
              )}
            </div>
            
            {/* Close/Exit */}
            <button 
              onClick={handleExit}
              className="p-2 text-gray-400 hover:text-white hover:bg-white/10 
                         rounded-lg transition-colors ml-2"
              title="Exit presentation"
            >
              <X className="w-5 h-5" />
            </button>
          </div>
        </div>
      </header>
      
      {/* Main Content Area */}
      <main className="flex-1 relative overflow-hidden">
        {/* Slide Content */}
        <div className="absolute inset-0 flex items-center justify-center p-4 md:p-8">
          <div className="w-full h-full max-w-7xl bg-white rounded-lg shadow-xl overflow-hidden">
            {/* Render current slide */}
            <SlideRenderer 
              slide={slides[currentSlide]} 
              cma={cma}
            />
          </div>
        </div>
        
        {/* Navigation Arrows */}
        <button
          onClick={() => setCurrentSlide(prev => Math.max(prev - 1, 0))}
          disabled={currentSlide === 0}
          className="absolute left-2 md:left-4 top-1/2 -translate-y-1/2 
                     p-3 bg-white/90 hover:bg-white rounded-full shadow-lg
                     disabled:opacity-30 disabled:cursor-not-allowed
                     transition-all z-10"
        >
          <ChevronLeft className="w-6 h-6 text-gray-700" />
        </button>
        
        <button
          onClick={() => setCurrentSlide(prev => Math.min(prev + 1, slides.length - 1))}
          disabled={currentSlide === slides.length - 1}
          className="absolute right-2 md:right-4 top-1/2 -translate-y-1/2 
                     p-3 bg-white/90 hover:bg-white rounded-full shadow-lg
                     disabled:opacity-30 disabled:cursor-not-allowed
                     transition-all z-10"
        >
          <ChevronRight className="w-6 h-6 text-gray-700" />
        </button>
      </main>
      
      {/* Footer Navigation */}
      <footer className="flex-shrink-0 bg-white border-t border-gray-200">
        <div className="flex items-center justify-between px-4 h-12">
          {/* Previous Slide Link */}
          <button
            onClick={() => setCurrentSlide(prev => Math.max(prev - 1, 0))}
            disabled={currentSlide === 0}
            className="flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 
                       disabled:opacity-30 disabled:cursor-not-allowed"
          >
            <ChevronLeft className="w-4 h-4" />
            <span className="hidden sm:inline">{slides[currentSlide - 1]?.title || 'Previous'}</span>
          </button>
          
          {/* Slide Dots / Progress */}
          <div className="flex items-center gap-1.5">
            {slides.length <= 20 ? (
              // Show dots for fewer slides
              slides.map((_, index) => (
                <button
                  key={index}
                  onClick={() => setCurrentSlide(index)}
                  className={`w-2 h-2 rounded-full transition-all ${
                    index === currentSlide 
                      ? 'bg-[#EF4923] w-4' 
                      : 'bg-gray-300 hover:bg-gray-400'
                  }`}
                />
              ))
            ) : (
              // Show progress bar for many slides
              <div className="w-32 h-1.5 bg-gray-200 rounded-full overflow-hidden">
                <div 
                  className="h-full bg-[#EF4923] transition-all"
                  style={{ width: `${((currentSlide + 1) / slides.length) * 100}%` }}
                />
              </div>
            )}
          </div>
          
          {/* Next Slide Link */}
          <button
            onClick={() => setCurrentSlide(prev => Math.min(prev + 1, slides.length - 1))}
            disabled={currentSlide === slides.length - 1}
            className="flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 
                       disabled:opacity-30 disabled:cursor-not-allowed"
          >
            <span className="hidden sm:inline">{slides[currentSlide + 1]?.title || 'Next'}</span>
            <ChevronRight className="w-4 h-4" />
          </button>
        </div>
      </footer>
      
      {/* Sections Drawer */}
      {showSections && (
        <SectionsDrawer 
          slides={slides}
          currentSlide={currentSlide}
          onSelectSlide={(index) => {
            setCurrentSlide(index);
            setShowSections(false);
          }}
          onClose={() => setShowSections(false)}
        />
      )}
    </div>
  );
}
```

### Step 3: Update the "Start Presentation" button

Change the button from opening a modal to navigating to the full page:

```tsx
// BEFORE - Opens modal
<button onClick={() => setShowPresentationModal(true)}>
  Start Presentation
</button>

// AFTER - Navigates to full page
<button onClick={() => navigate(`/cma/${cmaId}/presentation`)}>
  Start Presentation
</button>

// Or using a Link
<Link to={`/cma/${cmaId}/presentation`}>
  <button className="...">Start Presentation</button>
</Link>
```

### Step 4: Remove the old modal component

If the modal is no longer needed, remove or keep as fallback:

```tsx
// Remove modal state and component if not needed elsewhere
// const [showPresentationModal, setShowPresentationModal] = useState(false);

// Remove modal render
// {showPresentationModal && <CMAPresentationModal ... />}
```

---

## Part 4: Handle Browser Navigation

### Add URL state for current slide

```tsx
// Update URL when slide changes (for sharing/bookmarking)
useEffect(() => {
  const url = new URL(window.location.href);
  url.searchParams.set('slide', String(currentSlide + 1));
  window.history.replaceState({}, '', url.toString());
}, [currentSlide]);

// Read initial slide from URL
useEffect(() => {
  const url = new URL(window.location.href);
  const slideParam = url.searchParams.get('slide');
  if (slideParam) {
    const slideIndex = parseInt(slideParam) - 1;
    if (!isNaN(slideIndex) && slideIndex >= 0 && slideIndex < slides.length) {
      setCurrentSlide(slideIndex);
    }
  }
}, [slides.length]);
```

### Handle browser back button

```tsx
// Confirm before leaving if needed
useEffect(() => {
  const handleBeforeUnload = (e: BeforeUnloadEvent) => {
    // Optional: warn before leaving
    // e.preventDefault();
    // e.returnValue = '';
  };
  
  window.addEventListener('beforeunload', handleBeforeUnload);
  return () => window.removeEventListener('beforeunload', handleBeforeUnload);
}, []);
```

---

## Part 5: Mobile Optimization

```tsx
// Full page layout - mobile responsive
<div className="h-screen w-screen flex flex-col">
  {/* Header - compact on mobile */}
  <header className="h-12 md:h-14 ...">
    {/* Hide some elements on mobile */}
    <span className="hidden md:inline">Agent Name</span>
  </header>
  
  {/* Content - full height minus header/footer */}
  <main className="flex-1 overflow-hidden">
    {/* Navigation arrows - larger touch targets on mobile */}
    <button className="p-3 md:p-4 min-w-[44px] min-h-[44px] ...">
      <ChevronLeft className="w-5 h-5 md:w-6 md:h-6" />
    </button>
  </main>
  
  {/* Footer - always visible */}
  <footer className="h-12 ...">
    {/* Simplified on mobile */}
  </footer>
</div>
```

---

## Summary of Changes

| Change | Before | After |
|--------|--------|-------|
| Favorites icon | Present in header | Removed |
| Search icon | After star icon | Repositioned, more prominent |
| Presentation view | Modal overlay | Full page route |
| URL | Same page | `/cma/:cmaId/presentation` |
| Navigation | Modal close button | Back button + Exit |
| Browser back | Closes modal | Returns to previous page |

---

## Verification Checklist

- [ ] Star/favorites icon removed from header
- [ ] Search icon properly positioned
- [ ] Presentation opens as full page
- [ ] URL updates to `/cma/:id/presentation`
- [ ] Browser back button works correctly
- [ ] Keyboard navigation (arrows, escape) works
- [ ] Mobile layout is responsive
- [ ] Slide counter shows correctly
- [ ] Sections drawer still works
- [ ] Exit button returns to transaction page