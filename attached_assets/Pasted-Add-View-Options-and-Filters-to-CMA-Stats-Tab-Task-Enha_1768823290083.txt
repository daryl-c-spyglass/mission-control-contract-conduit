Add View Options and Filters to CMA Stats Tab
Task
Enhance the CMA Stats tab to include view toggle options, status filters, and comparable criteria summary - matching the functionality shown in the Compare view.
Reference Screenshot
The attached screenshot shows the Compare view with features to replicate in Stats view:

View toggle in header (Compare, Map, Stats, List)
Status filter tabs: All, Closed, Active Under Contract, Pending, Active
Stats summary row: Low Price, High Price, Avg Price, Median, Avg $/Sqft, Avg DOM
Color-coded status indicators (green=Active, red=Closed, orange=Under Contract)


Required Changes to Stats View
1. Add View Type Toggle
Add a view selector within the Stats tab allowing users to switch between different data presentations:
typescript// client/src/components/CMA/views/StatsView.tsx

type StatsViewType = 'grid' | 'list' | 'table';

const StatsView = ({ comparables, subjectProperty }) => {
  const [viewType, setViewType] = useState<StatsViewType>('grid');
  const [statusFilter, setStatusFilter] = useState<string>('all');
  
  // Filter comparables by status
  const filteredComparables = statusFilter === 'all' 
    ? comparables 
    : comparables.filter(comp => normalizeStatus(comp.status) === statusFilter);

  return (
    <div>
      {/* Status Filter Tabs */}
      <StatusFilterTabs 
        activeFilter={statusFilter} 
        onFilterChange={setStatusFilter}
        comparables={comparables}
      />
      
      {/* Stats Summary Row */}
      <StatsSummaryRow comparables={filteredComparables} />
      
      {/* View Type Toggle */}
      <ViewTypeToggle viewType={viewType} onViewTypeChange={setViewType} />
      
      {/* Conditional View Rendering */}
      {viewType === 'grid' && <StatsGridView comparables={filteredComparables} />}
      {viewType === 'list' && <StatsListView comparables={filteredComparables} />}
      {viewType === 'table' && <StatsTableView comparables={filteredComparables} />}
    </div>
  );
};
2. Status Filter Tabs Component
typescript// client/src/components/CMA/StatusFilterTabs.tsx

const STATUS_FILTERS = [
  { id: 'all', label: 'All' },
  { id: 'closed', label: 'Closed' },
  { id: 'activeUnderContract', label: 'Active Under Contract' },
  { id: 'pending', label: 'Pending' },
  { id: 'active', label: 'Active' },
];

const StatusFilterTabs = ({ activeFilter, onFilterChange, comparables }) => {
  // Calculate count for each status
  const getCount = (status: string) => {
    if (status === 'all') return comparables.length;
    return comparables.filter(c => normalizeStatus(c.status) === status).length;
  };

  return (
    <div className="flex gap-2 bg-[#2a2a2a] p-2 rounded-t-lg">
      {STATUS_FILTERS.map(filter => (
        <button
          key={filter.id}
          onClick={() => onFilterChange(filter.id)}
          className={`px-4 py-2 text-sm font-medium rounded transition-colors ${
            activeFilter === filter.id
              ? 'bg-white text-gray-900'
              : 'text-gray-300 hover:text-white hover:bg-gray-700'
          }`}
        >
          {filter.label}
          {getCount(filter.id) > 0 && (
            <span className="ml-1 text-xs">({getCount(filter.id)})</span>
          )}
        </button>
      ))}
    </div>
  );
};
3. Stats Summary Row Component
typescript// client/src/components/CMA/StatsSummaryRow.tsx

const StatsSummaryRow = ({ comparables }) => {
  const stats = useMemo(() => {
    const prices = comparables.map(c => c.soldPrice || c.listPrice).filter(Boolean);
    const pricesPerSqft = comparables
      .map(c => (c.soldPrice || c.listPrice) / c.sqft)
      .filter(Boolean);
    const doms = comparables.map(c => c.dom).filter(Boolean);
    
    return {
      lowPrice: Math.min(...prices),
      highPrice: Math.max(...prices),
      avgPrice: prices.reduce((a, b) => a + b, 0) / prices.length,
      medianPrice: getMedian(prices),
      avgPricePerSqft: pricesPerSqft.reduce((a, b) => a + b, 0) / pricesPerSqft.length,
      avgDom: Math.round(doms.reduce((a, b) => a + b, 0) / doms.length),
    };
  }, [comparables]);

  return (
    <div className="grid grid-cols-6 gap-4 bg-[#2a2a2a] p-4 text-white">
      <div>
        <div className="text-xs text-gray-400 uppercase">Low Price</div>
        <div className="text-xl font-bold">${formatPrice(stats.lowPrice)}</div>
      </div>
      <div>
        <div className="text-xs text-gray-400 uppercase">High Price</div>
        <div className="text-xl font-bold">${formatPrice(stats.highPrice)}</div>
      </div>
      <div>
        <div className="text-xs text-gray-400 uppercase">Avg Price</div>
        <div className="text-xl font-bold">${formatPrice(stats.avgPrice)}</div>
      </div>
      <div>
        <div className="text-xs text-gray-400 uppercase">Median</div>
        <div className="text-xl font-bold">${formatPrice(stats.medianPrice)}</div>
      </div>
      <div>
        <div className="text-xs text-gray-400 uppercase">Avg $/Sqft</div>
        <div className="text-xl font-bold">${Math.round(stats.avgPricePerSqft)}</div>
      </div>
      <div>
        <div className="text-xs text-gray-400 uppercase">Avg DOM</div>
        <div className="text-xl font-bold">{stats.avgDom} Days</div>
      </div>
    </div>
  );
};
4. View Type Toggle Component
typescript// client/src/components/CMA/ViewTypeToggle.tsx

import { LayoutGrid, List, Table } from 'lucide-react';

const VIEW_OPTIONS = [
  { id: 'grid', icon: LayoutGrid, label: 'Grid' },
  { id: 'list', icon: List, label: 'List' },
  { id: 'table', icon: Table, label: 'Table' },
];

const ViewTypeToggle = ({ viewType, onViewTypeChange }) => {
  return (
    <div className="flex items-center gap-2 p-4 border-b">
      <span className="text-sm text-gray-500 mr-2">View:</span>
      <div className="flex rounded-lg overflow-hidden border">
        {VIEW_OPTIONS.map(option => {
          const Icon = option.icon;
          return (
            <button
              key={option.id}
              onClick={() => onViewTypeChange(option.id)}
              className={`flex items-center gap-1 px-3 py-2 text-sm transition-colors ${
                viewType === option.id
                  ? 'bg-primary text-white'
                  : 'bg-white text-gray-700 hover:bg-gray-100'
              }`}
              title={option.label}
            >
              <Icon className="w-4 h-4" />
              <span className="hidden sm:inline">{option.label}</span>
            </button>
          );
        })}
      </div>
    </div>
  );
};
5. Three View Components
typescript// Grid View - Card-based layout (current Stats view style)
const StatsGridView = ({ comparables }) => {
  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4">
      {/* Summary cards, charts, etc. */}
      <SummaryCards comparables={comparables} />
      <PriceComparisonChart comparables={comparables} />
      <MarketReviewSection comparables={comparables} />
    </div>
  );
};

// List View - Vertical list of properties with stats
const StatsListView = ({ comparables }) => {
  return (
    <div className="divide-y">
      {comparables.map(comp => (
        <div key={comp.mlsId} className="p-4 flex items-center gap-4">
          <img src={comp.photo} className="w-20 h-20 object-cover rounded" />
          <div className="flex-1">
            <div className="font-medium">{comp.address}</div>
            <div className="text-sm text-gray-500">{comp.city}, {comp.zip}</div>
          </div>
          <div className="text-right">
            <div className="text-lg font-bold text-primary">
              ${formatPrice(comp.soldPrice || comp.listPrice)}
            </div>
            <div className="text-sm text-gray-500">
              ${Math.round((comp.soldPrice || comp.listPrice) / comp.sqft)}/sqft
            </div>
          </div>
          <StatusBadge status={comp.status} />
        </div>
      ))}
    </div>
  );
};

// Table View - Spreadsheet-style data table (like Compare view)
const StatsTableView = ({ comparables }) => {
  return (
    <div className="overflow-x-auto">
      <table className="w-full">
        <thead className="bg-gray-50 text-left text-sm text-gray-500">
          <tr>
            <th className="p-3">Address</th>
            <th className="p-3">Status</th>
            <th className="p-3">Price</th>
            <th className="p-3">Sold Date</th>
            <th className="p-3">$/Sq.Ft</th>
            <th className="p-3">DOM</th>
            <th className="p-3">Beds</th>
            <th className="p-3">Baths</th>
            <th className="p-3">Sq. Ft.</th>
            <th className="p-3">Lot Size</th>
            <th className="p-3">Garage</th>
          </tr>
        </thead>
        <tbody className="divide-y">
          {comparables.map(comp => (
            <tr key={comp.mlsId} className="hover:bg-gray-50">
              <td className="p-3">
                <div className="flex items-center gap-2">
                  <StatusDot status={comp.status} />
                  <div>
                    <div className="font-medium">{comp.address}</div>
                    <div className="text-sm text-gray-500">{comp.city}, {comp.zip}</div>
                  </div>
                </div>
              </td>
              <td className="p-3">
                <StatusText status={comp.status} />
              </td>
              <td className="p-3 font-medium">${formatPrice(comp.soldPrice || comp.listPrice)}</td>
              <td className="p-3 text-gray-500">{comp.soldDate || '-'}</td>
              <td className="p-3">${Math.round((comp.soldPrice || comp.listPrice) / comp.sqft)}</td>
              <td className="p-3">{comp.dom || '-'}</td>
              <td className="p-3">{comp.beds}</td>
              <td className="p-3">{comp.baths}</td>
              <td className="p-3">{formatNumber(comp.sqft)}</td>
              <td className="p-3">{comp.lotSize || '-'}</td>
              <td className="p-3">{comp.garageSpaces || '-'}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
};
6. Helper Components
typescript// Status Dot (colored circle indicator)
const StatusDot = ({ status }) => {
  const colorClass = {
    active: 'bg-green-500',
    closed: 'bg-red-500',
    activeUnderContract: 'bg-orange-500',
    pending: 'bg-gray-500',
  }[normalizeStatus(status)] || 'bg-gray-500';
  
  return <div className={`w-3 h-3 rounded-full ${colorClass}`} />;
};

// Status Text (colored text)
const StatusText = ({ status }) => {
  const normalized = normalizeStatus(status);
  const config = {
    active: { text: 'Active', class: 'text-green-600' },
    closed: { text: 'Closed', class: 'text-red-600' },
    activeUnderContract: { text: 'Active Under Contract', class: 'text-orange-600' },
    pending: { text: 'Pending', class: 'text-gray-600' },
  }[normalized] || { text: status, class: 'text-gray-600' };
  
  return <span className={config.class}>{config.text}</span>;
};

Files to Modify/Create

client/src/components/CMA/views/StatsView.tsx (update)
client/src/components/CMA/StatusFilterTabs.tsx (create)
client/src/components/CMA/StatsSummaryRow.tsx (create)
client/src/components/CMA/ViewTypeToggle.tsx (create)


Acceptance Criteria

 Status filter tabs appear at top of Stats view (All, Closed, Active Under Contract, Pending, Active)
 Stats summary row displays: Low Price, High Price, Avg Price, Median, Avg $/Sqft, Avg DOM
 View type toggle allows switching between Grid, List, and Table views
 Filtering by status updates both the stats summary and the displayed properties
 Status colors match: Green=Active, Red=Closed, Orange=Under Contract, Gray=Pending
 Dark background (#2a2a2a) for filter tabs and stats summary row
 Grid view shows cards and charts (existing stats layout)
 List view shows vertical property list with key stats
 Table view shows full data table like Compare view